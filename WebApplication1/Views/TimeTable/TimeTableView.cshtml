@model AMS.Models.ViewModels.EditTimetableViewModel
@{
    ViewData["Title"] = "Timetable";
    var days = Enum.GetValues(typeof(DayOfWeek)).Cast<DayOfWeek>().OrderBy(d => d == DayOfWeek.Sunday ? 7 : (int)d);

    // Define a palette of stronger, more visible colors for course cards
    var colorPalette = new[]
    {
        new { Bg = "bg-blue-100 dark:bg-blue-900/40", Border = "border-blue-200 dark:border-blue-700", Text = "text-blue-900 dark:text-blue-100", Subtext = "text-blue-700 dark:text-blue-300", Icon = "text-blue-600 dark:text-blue-400" },
        new { Bg = "bg-purple-100 dark:bg-purple-900/40", Border = "border-purple-200 dark:border-purple-700", Text = "text-purple-900 dark:text-purple-100", Subtext = "text-purple-700 dark:text-purple-300", Icon = "text-purple-600 dark:text-purple-400" },
        new { Bg = "bg-emerald-100 dark:bg-emerald-900/40", Border = "border-emerald-200 dark:border-emerald-700", Text = "text-emerald-900 dark:text-emerald-100", Subtext = "text-emerald-700 dark:text-emerald-300", Icon = "text-emerald-600 dark:text-emerald-400" },
        new { Bg = "bg-amber-100 dark:bg-amber-900/40", Border = "border-amber-200 dark:border-amber-700", Text = "text-amber-900 dark:text-amber-100", Subtext = "text-amber-700 dark:text-amber-300", Icon = "text-amber-600 dark:text-amber-400" },
        new { Bg = "bg-rose-100 dark:bg-rose-900/40", Border = "border-rose-200 dark:border-rose-700", Text = "text-rose-900 dark:text-rose-100", Subtext = "text-rose-700 dark:text-rose-300", Icon = "text-rose-600 dark:text-rose-400" },
        new { Bg = "bg-cyan-100 dark:bg-cyan-900/40", Border = "border-cyan-200 dark:border-cyan-700", Text = "text-cyan-900 dark:text-cyan-100", Subtext = "text-cyan-700 dark:text-cyan-300", Icon = "text-cyan-600 dark:text-cyan-400" },
    };

    dynamic GetColor(string name)
    {
        if (string.IsNullOrEmpty(name)) return colorPalette[0];
        int index = Math.Abs(name.GetHashCode()) % colorPalette.Length;
        return colorPalette[index];
    }
}

<div class="space-y-8">
    <!-- Header -->
    <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                Weekly Schedule
            </h2>
            <p class="text-gray-500 dark:text-gray-400">
                @Model.BatchName &bull; @Model.SemesterName
            </p>
        </div>
        <div>
            @if (Model.IsActive)
            {
                <span class="inline-flex items-center rounded-full bg-green-50 px-3 py-1 text-sm font-medium text-green-700 ring-1 ring-inset ring-green-600/20 dark:bg-green-900/30 dark:text-green-400 dark:ring-green-500/30">
                    <span class="mr-1.5 h-1.5 w-1.5 rounded-full bg-green-600 dark:bg-green-400"></span>
                    Active Schedule
                </span>
            }
            else
            {
                <span class="inline-flex items-center rounded-full bg-gray-50 px-3 py-1 text-sm font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 dark:bg-gray-400/10 dark:text-gray-400 dark:ring-gray-400/20">
                    Inactive
                </span>
            }
        </div>
    </div>

    <!-- Timetable Grid -->
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4">
        @foreach (var day in days)
        {
            var daySlots = Model.Slots.Where(s => s.DayOfWeek == (int)day).OrderBy(s => s.StartTime).ToList();
            var isToday = DateTime.Now.DayOfWeek == day;

            <div class="flex flex-col overflow-hidden rounded-2xl border @(isToday ? "border-brand-200 ring-4 ring-brand-50 dark:border-brand-700 dark:ring-brand-900/20" : "border-gray-200 dark:border-gray-800") bg-white shadow-sm transition-all hover:shadow-md dark:bg-gray-900">
                <div class="border-b border-gray-100 bg-gray-50/50 px-6 py-4 dark:border-gray-800 dark:bg-gray-800/50">
                    <div class="flex items-center justify-between">
                        <h4 class="font-bold @(isToday ? "text-brand-600 dark:text-brand-400" : "text-gray-900 dark:text-white")">
                            @day
                        </h4>
                        @if (isToday)
                        {
                            <span class="rounded-full bg-brand-100 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-brand-700 dark:bg-brand-900/30 dark:text-brand-300">Today</span>
                        }
                    </div>
                </div>

                <div class="flex-1 space-y-3 p-4">
                    @if (daySlots.Any())
                    {
                        @foreach (var slot in daySlots)
                        {
                            var color = GetColor(slot.CourseName);

                            <div class="group relative flex flex-col gap-1 rounded-xl border @color.Border @color.Bg p-4 transition-all hover:scale-[1.02]">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-1.5">
                                        <svg class="@color.Icon h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <span class="text-xs font-bold uppercase tracking-wide @color.Subtext">
                                            @slot.StartTime.ToString("h:mm tt") - @slot.EndTime.ToString("h:mm tt")
                                        </span>
                                    </div>

                                    @if (Model.CanMarkAttendance && slot.CourseAssignmentId.HasValue)
                                    {
                                        @if (slot.AttendanceStatus == "Marked")
                                        {
                                            <a asp-controller="Attendance" asp-action="Mark" asp-route-slotId="@slot.SlotId"
                                               class="flex h-6 w-6 items-center justify-center rounded-full bg-green-100 text-green-700 shadow-sm transition-colors hover:bg-green-200 dark:bg-green-900/50 dark:text-green-400 dark:hover:bg-green-900/70"
                                               title="Attendance Marked (Click to Edit)">
                                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                                </svg>
                                            </a>
                                        }
                                        else
                                        {
                                            <a asp-controller="Attendance" asp-action="Mark" asp-route-slotId="@slot.SlotId"
                                               class="flex h-6 w-6 items-center justify-center rounded-full bg-white text-gray-400 shadow-sm transition-colors hover:bg-brand-500 hover:text-white dark:bg-gray-800 dark:hover:bg-brand-500"
                                               title="Mark Attendance">
                                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                                </svg>
                                            </a>
                                        }
                                    }
                                </div>

                                <div>
                                    <h5 class="font-bold leading-tight @color.Text">
                                        @slot.CourseName
                                    </h5>
                                    <p class="mt-1 text-sm font-medium @color.Subtext">
                                        @slot.TeacherName
                                    </p>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="flex h-32 flex-col items-center justify-center rounded-xl border border-dashed border-gray-200 bg-gray-50/50 text-center dark:border-gray-800 dark:bg-gray-800/30">
                            <div class="rounded-full bg-gray-100 p-2 dark:bg-gray-800">
                                <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                </svg>
                            </div>
                            <p class="mt-2 text-xs font-medium text-gray-400">No classes scheduled</p>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>
